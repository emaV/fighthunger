[[PageOutline]]

== Modules ==

||module 4.6 	|| description 	|| proposal ||
||campaign 	||	        || REMOVE   ||
||echo_action 	|| Creates flexible / templated nodes for online political organizing. 	|| REMOVE ||
||echo_action_transition 	|| Adds some information for gathering-1 node typ 	|| REMOVE ||
||echo_slideshow 	|| Displays flicker image. Has heavyweight init hook 	|| use template and flickr (flash and little square)  ||
||flashcard 	||      ||CHECK ||
||gathering 	|| Gathering node type. Interfaces with CiviCRM 	|| REMOVE ||
||wtw 	        || Walk administration. Node type: walk action story 	|| ||
||wtw_map 	|| Draws maps 	|| location + gmap ||
||wtw_signup 	|| Walk sign-up || ||

== Implementation ==

We can use group (as for http://www.standagainstpoverty.org/) with taxonomy or just event and taxonomy.

For each "walk" we need:
 * simple content -> create a fhevent.module (new custom module) or use contento.module
 * location -> [http://drupal.org/project/location location.module]
 * scheduling -> [http://drupal.org/project/event event.module]
 * subscription -> [http://drupal.org/project/volunteer volunteer.module] - '''NO''' volunteer rely on CiviCrm and we nedd different field for subscription; we can take some code from there (cutting CiviCrm part)
 * donation or fee -> donation.module
 * partner integration -> upgrade of 4.6 fh partner.module (?)
 * status (active / post-action / closed) - workflow.module and action.module (?)
 * flickr integration -> check last year code

All this need to be templated.

Each walk will be associated to a taxonomy term under campaign dictionary (wtw05, wtw06, wtw07). On the front page of each taxonomy we put a gmap with all events.

== Ticket to ride ==
[[TicketQuery(component=WalkTool2007)]]


== fwalk.module ==
This module replace gathering.module. Use forward.module, location.module, event.module.
After the installation we need to
  * set permissions
  * set vocabulary (admin/settings/fhwalk)
  * enable for event and location
  * change weight on system table (to catch all others module hooks)

=== SQL issues ===
After installatione some SQL query needs to be run:

1 - change gathering-n to fhwalk
{{{
#!sql
UPDATE node SET `type`='fhwalk' WHERE `type` LIKE 'gather%';
}}}

2 - lowercase on location table
{{{
#!sql
UPDATE `location` SET `country`=LOWER(`country`);
}}}

3 - move data from gathering-1 and 2 to event!! (but we have to check for time zone of ewh servers!!!)

2006-05-21 10:00:00 convert to 1148220000 ewhserver should be 1148202000 so we have to subtract 18000 

'''FIRST''' check for enddate on gatherning_node; some record is 0000-00-00

{{{
#!sql
SELECT * FROM gathering_node WHERE enddate='0000-00-00';
UPDATE gathering_node SET enddate=startdate WHERE enddate='0000-00-00';
}}}

'''SECOND''' generate timestamp and insert into event table
{{{
#!sql
INSERT INTO `event` (nid, event_start, event_end)
  SELECT `nid`, 
    UNIX_TIMESTAMP( ADDTIME( `startdate` , `starttime` ))-18000 AS event_start, 
    UNIX_TIMESTAMP( ADDTIME( `enddate`   , `endtime`   ))-18000 AS event_end 
    FROM `gathering_node`;
}}}

== Things to do ==

===  Roles  ===
Roles for walk tool needs to be 5:
 
  * Walker – signs up to join a walk (already exists)
  * Walk Organiser – single walk (already exists)
  * Multiple Walk Organiser (already exists through settings in admin)
  * Walk Coordinator [#62] – new role. The person who coordinates the walk organisers. An email contact facility is needed so that any Walk Coordinator can contact the walk organisers they are responsible for through the site 
  * Walk Administrator - new role: assign walk to Walk Coordinators [#69]

Walk Organisers and Multiple Walk Organisers need a facility on the site to write to all walkers [#61]. Kind of mailing list but controlled using the site.

Walk Coordinator need a tool to write to Walk Organisers and Multiple Walk Organisers [#63]. It means that each walk will have an Organiser and a Coordinator (Coordinator will be selected manually by admin.)

=== Walk language ===
Walk information should be entered in all language. It means that fhwalk should be under i18n. It means that if we create a walk in Danish we will have interface (l10n) in english but content (at least body/title  and route) in danish, thus the link to the node will be dk/1234 (even if we are starting from en/wtw07!!!!). In some country we could have more than one language (Switzerland could be en/fr/de/it, Canada en/fr).

=== Page layout ===

No left column!

||'''central column''' 	||'''left'''||
|| || ||
||''walk main'' || ''global partners'' ||
|| * when[[BR]] * where[[BR]]  * route || ||
|| || ||
|| ''country partners'' || ||
|| || ||
|| ''walk other details'' || ||
|| || ||
|| ''local partners'' || ||
|| || ||
|| ''local country page''  [#70]|| ||
|| || ||
|| ''comments'' || || 

Some note:
  * this page is generated using 2 nodes: walk node and local country page;
  * some content will be translated with i18n some other not;

=== Waiver Signup [#64] ===
For each event Walk Organisers (or Multiple Walk Organisers) could change standard insurance waiver. Any change will be submitted to Walk Coordinator for approvation. Until this approvation signup is not possible!

=== Group Signup [#65] ===
Currently it's possible to use the guest field for groups ("I am user Qwery and I'm bringing 4 more person"). We need on walk creation to let Walk Organisers to make this an option (important in USA, Canada, UK for waiver reasons).

=== Walker Comments [#66] ===
Toggle user comments display on walk creation/editing.

=== Walker Number [#67] ===
Toggle number of walker display on walk creation/editing.

=== Partner [#68] and ([wiki:Partner2007 Partner]) ===
Currently local partner is not linked to a specific country. We need this. So we have:
  * Global Partners (shown on the left column)
  * Country Partners (shown after main walk details)
  * Local Country Partners (shown after walk other details)

=== Revenue sharing [#68] ===
Some of the Local Country Partners will be on revenue sharing (optional field selected by means of some permission to add).
On each Personal Page user can select if they want to collect money for an event. If they do, a list of Local Country Partners with revenue sharing field set will be on the page.
 
== Post Walk page ==
Walk page on a campaign closed are rendered in a different way.
We need:

  * integrate flickr feeds
  * change tell a friend content

== Previous Walk ==
We need to recover previous year data so they will be shown as for this year. We need to:

  * enter data in location table (almost done but check needed)
  * change old local pages to new scheme (probably just changing node type and taxonomy)
  * enter sponsor in partners table
